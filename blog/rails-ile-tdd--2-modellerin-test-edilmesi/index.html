<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification"
    content="0emXjEbk_ZIziWSlcEWaCEaOIivGlP2tiGnQPLvZKNE" />
    <title>Rails ile TDD - 2 (Modellerin test edilmesi)</title>
    
    <meta name="description" content="Ruby, JavaScript, Clojure ve diğer yazılım maceralarım
">
    
    <link rel="canonical" href="http://turhancoskun.com/blog/rails-ile-tdd--2-modellerin-test-edilmesi/">
    <link href='http://fonts.googleapis.com/css?family=PT+Serif:400,700,400italic,700italic|Didact+Gothic&subset=latin,latin-ext' rel='stylesheet' type='text/css'>
</head>


<body class="showing-post">
  <div class="pure-g">
    <div class="content pure-u-1 pure-u-md-3-4">
      <div>
          <div class="post-nav-bar pure-g">
            <div class="pure-u-1-3">
              <figure>
                <a href="/">
                  <img class="post-avatar" src="/assets/profile200x200.jpg" alt="Turhan Coskun" />
                </a>
              </figure>
            </div>
            <div class="blog-name pure-u-1-3">
              <div><a href="/">Turhan Coskun</a></div>
            </div>
            <div class="pure-u-1-3">
            </div>
          </div>

        <div class="post">
          <header class="post-header">
            <h1 class="post-title">Rails ile TDD - 2 (Modellerin test edilmesi)</h1>
            <div class="post-meta">Nov 16, 2014
            <div>
              
              <a class="post-category" href="/tag/Ruby">Ruby</a>
              
              <a class="post-category" href="/tag/Ruby on Rails">Ruby on Rails</a>
              
              <a class="post-category" href="/tag/TDD">TDD</a>
              
              <a class="post-category" href="/tag/Dersler">Dersler</a>
              
            </div>
            </div>
          </header>

          <article class="post-content">
            <p>Rails ile TDD serisinin ikinci bölümünde sizlere bir MVC framework olan Ruby on Rails’in
M’i yani model kısmının nasıl test edileceğini anlatmak istiyorum. Hello World’den sonra
ikinci seviye sayılabilecek bir ToDo yani yapılacaklar listesi uygulaması geliştirelim.</p>

<p>Uygulamada tüm değişken, sınıf, modül vs istisnasız tüm tanımlamalarınızı İngilizce
olarak yapın. Rails’te çok fazla önkabul bulunur ve tüm bu önkabuller İngilizce
dil kurallarına göre çalışır. Bunun faydasından yararlanmak dururken boşuna buna karşı
savaşmayın.</p>

<p>Gevezeliği bırakırsak örnek uygulamamızın yapısından bahsetmek istiyorum.</p>

<h2 id="projenin-planlanmas">Projenin Planlanması</h2>

<ul>
  <li>Kullanıcı mail adresini girip kendi yapılacaklar listesine giriş yapar (Şifre olmayacak)</li>
  <li>Yapılacak listesine öğe ekleyip silebilir ya da tamamlandı, tamamlanmadı tercihi yapabilir. Tamamlandı seçeneği seçildiğinde completed_at alanı güncellenir. Tamamlanmadı seçeneği seçildiğinde complete_at seçeneği nil olarak ayarlanır.</li>
</ul>

<p>Bunu gerçekleştirebilmek için bize iki model gerekiyor bunlar User ve Todo</p>

<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">User</span>
  <span class="l-Scalar-Plain">email</span>
<span class="l-Scalar-Plain">Todo</span>
  <span class="l-Scalar-Plain">user</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">User</span>
  <span class="l-Scalar-Plain">title</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">String</span>
  <span class="l-Scalar-Plain">complete_at</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">DateTime</span></code></pre></div>

<h2 id="user-modelinin-oluturulmas">User modelinin oluşturulması</h2>

<p>TDD yani test güdümlü programlama dediğimize göre demekki öncelikle test yazılması gerekiyor. Önce test yazmak bizi hatalardan koruduğu gibi büyük kod blokları yazarken de bizi motive edip bizi yönlendirecek. Göreceksiniz ki doğru kod yazım yaklaşımı önce test kodu yazmaktır.</p>

<p>Kısaca TDD’den bahsedersek yapacağımız işlem sırası RED-GREEN-REFACTOR. Bu konu hakkında araştırma yapmayı ve en iyi pratik seviyelerine ulaşmayı size bırakıyorum. R-G-R ‘yi bizim User modelimize uygularsak:</p>

<ol>
  <li>Önce User model testi için gerekli spec/models/user_spec.rb dosyasına beklentilerimizi yazacağız.</li>
  <li>User modelinin beklentileri karşılaması için beklentileri yazacağız. ( email alanı boş olamaz ve geçerli bir email adresi olmalı gibi )</li>
  <li>En son testi çalıştıracağız ve kırmızı spec’ler yeşil olana kadar modelimizi geliştireceğiz.</li>
</ol>

<p>Hadi başlayalım:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">git checkout -b user-model</code></pre></div>

<p>Konsol ekranımıza aşağıdaki komutu girelim:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">rails g model User email</code></pre></div>

<p>Aslında burada önce test prensibini kısmen çiğnemiş olduk ama bu koşullarda bizim çıkarımıza bu şekilde ilerlemek daha hızlı. (Pragmatist Programmer kitabını okumanızı şiddetle öneririm)</p>

<p>Ekran çıktısından gördüğünüz üzere spec/models/user_spec.rb otomatik olarak oluşturuldu. Hemen bu dosyayı açıp inceleyelim.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">require</span> <span class="s1">&#39;rails_helper&#39;</span>

<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">User</span><span class="p">,</span> <span class="ss">:type</span> <span class="o">=&gt;</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">pending</span> <span class="s2">&quot;add some examples to (or delete) </span><span class="si">#{</span><span class="bp">__FILE__</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="k">end</span></code></pre></div>

<p>Daha önce bahsettiğimiz rails_helper dosyası en başa gelmiş. User için model tipinde bir spec tanımlanmış. Bu dosyayı birlikte beklentilerimizi karşılayacak şekilde düzenleyeceğiz ama öncelikle olduğu gibi çalıştırıp bir duman testi yapalım. Duman testi, test framework’unun çalışır durumda olduğunu tespit etmek için yaptığımız basit testlere verdiğimiz bir isim.</p>

<p>İlk testi çalıştırmadan önce akıl sağlımız için ana dizindeki .rspec dosyasını açıp içinden –warning satırını silmenizi öneririm. Aksi halde ekranınızda uyarıdan başka birşey gözükmüyor. Daha sonra konsol ekranında:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">rake db:migrate
rspec spec/models/user_spec.rb</code></pre></div>

<p>rake komutu ruby make deyiminin bir kısaltması. Konsolda açık kaynak programların kodlarını derlerken kullandığımız make komutunun ruby versiyonu. db:migrate ise User oluşturulurken otomatik olarak oluşturulan veri tabanı migration dosyasını çalıştırıyor.</p>

<p>rspec komutunun ardından ekranda</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># Not yet implemented</span>
<span class="c1"># ./spec/models/user_spec.rb:4</span></code></pre></div>

<p>çıktılarını gördüyseniz duman testini geçmişsiniz demektir. Artık testimizi icra etmeye başlayabiliriz.</p>

<p>Öncelikle git repomuza değişiklikleri kaydedelim.</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">git add --all
git commit <span class="s2">&quot;User model oluşturulması&quot;</span></code></pre></div>

<p>tekrar user_spec.rb dosyasını açalım. (Artık yerini biliyoruz değil mi?)</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">require</span> <span class="s1">&#39;rails_helper&#39;</span>

<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">User</span><span class="p">,</span> <span class="ss">:type</span> <span class="o">=&gt;</span> <span class="ss">:model</span> <span class="k">do</span>

  <span class="n">it</span> <span class="s1">&#39;is invalid without email&#39;</span> <span class="k">do</span>
    <span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">email</span><span class="p">:</span> <span class="kp">nil</span><span class="p">)</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">user</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">be_invalid</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s1">&#39;is invalid without a valid email address&#39;</span> <span class="k">do</span>
    <span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">email</span><span class="p">:</span> <span class="s1">&#39;foo&#39;</span><span class="p">)</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">user</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">be_invalid</span>
    <span class="n">user</span><span class="o">.</span><span class="n">email</span> <span class="o">=</span> <span class="s1">&#39;foo@example.com&#39;</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">user</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">be_valid</span>
  <span class="k">end</span>

<span class="k">end</span></code></pre></div>

<p>Dosyamızı yukarıdaki gibi düzenleyelim. Kodun kendi kendini yeterince iyi açıkladığını düşünüyorum.</p>

<p>Testler it komutuyla başlıyor ve beklentiler block içinde belirtiyoruz. Beklentilerin yazımı expect metodo parametre olarak karşılaştıracağımız elimizdeki öğeyi alıyor. Ardından gelen .to veya olumsuz hali .not_to ve matcher dediğimiz be_invalid ve be_valid gibi eşleştiriciler izliyor. Rspec eşleştiricileri ile daha ayrıntılı bilgi için rspec dokümantasyonunu incelemenizi öneririm.</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">rspec spec/models/user_spec.rb</code></pre></div>

<p>Mevcut durumda her iki spec de kırmızı durumda ve bizim görevimiz bunları yeşile çevirmemiz gerekiyor. Aksi halde kullanıcılar boş email adresleri ekleyebilecek veya aslında email adresi olmayan verileri email alanına yazabilecekler.</p>

<p>app/models/user.rb dosyasını açalım. Burası User modelinin tanımlandığı yer ve doğrulama işlemlerini burada gerçekleştireceğiz.</p>

<p>mevcut haliyle user.rb dosyası</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
<span class="k">end</span></code></pre></div>

<p>gibi gözükecektir. Bizim yapacağımız aşağıdaki gibi düzenleyip testi tekrar çalıştırmak.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">validates</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">presence</span><span class="p">:</span> <span class="kp">true</span>
<span class="k">end</span></code></pre></div>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">rspec spec/models/user_spec.rb</code></pre></div>

<p>Bingo! Hata sayımız 1’e düştü ve beklentilerden biri yeşil ancak diğeri hala kırmızı. Şimdi diğer testi geçirelim.</p>

<p>Ekran çıktısını incelediğimizde anlıyoruz ki ‘foo’ hatalı bir email adresi olmak zorundayken modelimiz bunun hatalı olduğunu düşünmüyor öyleyse bunu sağlayalım.</p>

<h4 id="email-dorulamas">Email doğrulaması</h4>
<p>Email doğrulaması için basit gem kullanılabileceği gibi regex de yazılabilir. Dışarıya bağımlılığı minimum düzeyde tutabilmek için regex yolunu tercih ediyorum. Dilerseniz küçük bir araştırmayla email_validator nasıl kullanılır bulabilirsiniz.</p>

<p>User model dosyamızı tekrar açarak aşağıdaki gibi güncelleyelim:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">validates</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">presence</span><span class="p">:</span> <span class="kp">true</span>
  <span class="n">validates_format_of</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">:with</span> <span class="o">=&gt;</span> <span class="sr">/\A([^@\s]+)@((?:[-a-z0-9]+\.)+[a-z]{2,})\Z/i</span>
<span class="k">end</span></code></pre></div>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">rspec spec/models/user_spec.rb</code></pre></div>

<p>Ve bütün testlerimiz geçti. TDD ile spec dosyamızda User için beklentilerimizi belirledik ve testleri çalıştırdıkca aldığımız ekran çıktılarmı bizi yönlendirdi. Şimdilik User modeli ile işimiz bitti artık git repomuza gereken değişiklikleri kaydedip Todo modeline geçebiliriz.</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">git add --all
git commit <span class="s2">&quot;User model testleri geçti&quot;</span>
git checkout master
git merge user-model
git branch -d user-model</code></pre></div>

<h2 id="todo-modelinin-oluturulmas">Todo Modelinin Oluşturulması</h2>

<p>Todo modelimiz biraz daha karışık. Temelleri zaten User modeli için anlattığımdan burada bazı kısımları kestirme geçebilirim. Örneğin model dosyasını düzenleyin deyince size tam adresini vermeyebilirim ya da test komutunu çalıştırın dediğimde siz rspec komutunun ardından spec dosyasının yolunun geleceğini bilirsiniz diye varsayıyorum.</p>

<p>Şimdi User modelinde yaptığımız gibi yeni model oluşturalım.</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">git checkout -b todo-model
rails g model Todo title complete_at:date user:belongs_to
rake db:migrate</code></pre></div>

<p>user:belongs_to kısmı Todo modelinin user ile bire çok ilişki içinde olduğunu belirtmek için eklendi.</p>

<p>Şimdi todo_spec.rb dosyasını açarak beklentilerimizi programa belirtelim.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">require</span> <span class="s1">&#39;rails_helper&#39;</span>

<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">Todo</span><span class="p">,</span> <span class="ss">:type</span> <span class="o">=&gt;</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">context</span> <span class="s1">&#39;is invalid without&#39;</span> <span class="k">do</span>
    <span class="n">it</span> <span class="s1">&#39;a user&#39;</span>
    <span class="n">it</span> <span class="s1">&#39;a title&#39;</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></div>

<p>Şimdi konsol ekranından testi çalıştırarak sonuca birlikte inceleyelim.</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">Pending:
  Todo is invalid without a user
    <span class="c"># Not yet implemented</span>
    <span class="c"># ./spec/models/todo_spec.rb:5</span>
  Todo is invalid without a title
    <span class="c"># Not yet implemented</span>
    <span class="c"># ./spec/models/todo_spec.rb:6</span></code></pre></div>

<p>İki pending testimiz var ve rspec yazdığımız kod yapısını bizim için dokümantasyona dönüştürdü. Block yani do..end eki almamış it tanımları gördüğünüz gibi pending olarak işliyor. Projelerde bu özellikten sıklıkla faydalanabiliriz.</p>

<p>Şimdi testimizin içini doldurmaya başlayalım isterseniz. Tekrar todo_spec.rb dosyasını açarak aşağıdaki gibi düzenleyelim.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">require</span> <span class="s1">&#39;rails_helper&#39;</span>

<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">Todo</span><span class="p">,</span> <span class="ss">:type</span> <span class="o">=&gt;</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">context</span> <span class="s1">&#39;is invalid without&#39;</span> <span class="k">do</span>

    <span class="n">it</span> <span class="s1">&#39;a user&#39;</span> <span class="k">do</span>
      <span class="n">todo</span> <span class="o">=</span> <span class="no">Todo</span><span class="o">.</span><span class="n">new</span>
      <span class="n">todo</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Kodlar refactor edilecek.&#39;</span>
      <span class="n">expect</span><span class="p">(</span><span class="n">todo</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">be_invalid</span>
      <span class="n">todo</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">email</span><span class="p">:</span> <span class="s1">&#39;foo@example.com&#39;</span><span class="p">)</span>
      <span class="n">expect</span><span class="p">(</span><span class="n">todo</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">be_valid</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s1">&#39;a title&#39;</span> <span class="k">do</span>
      <span class="n">todo</span> <span class="o">=</span> <span class="no">Todo</span><span class="o">.</span><span class="n">new</span>
      <span class="n">todo</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="kp">nil</span>
      <span class="n">todo</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">email</span><span class="p">:</span> <span class="s1">&#39;foo@example.com&#39;</span><span class="p">)</span>
      <span class="n">expect</span><span class="p">(</span><span class="n">todo</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">be_invalid</span>
    <span class="k">end</span>

  <span class="k">end</span>
<span class="k">end</span></code></pre></div>

<p>Konsoldan testi çalıştırıp sonuca baktığımızda istediğimiz iki koşulun da model tarafından yerine getirilmediğini görüyoruz. Şimdi kırmızıları yeşil yapmak için Todo modelini açıp aşağıdaki gibi kodları ekliyoruz.
belongs_to :user satırının altına:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">validates</span> <span class="ss">:user</span><span class="p">,</span> <span class="ss">presence</span><span class="p">:</span> <span class="kp">true</span></code></pre></div>

<p>kaydedip testi tekrar çalıştırın. Göreceksiniz ki yerine getirilmesi tek bir koşul kaldı.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">validates</span> <span class="ss">:title</span><span class="p">,</span> <span class="ss">presence</span><span class="p">:</span> <span class="kp">true</span></code></pre></div>

<p>rspec ile testi çalıştırıp tekrar sonucu kontrol ettiğimiz iki yeşilimiz olduğunu göreceksiniz. Ekranda görmeniz gereken sonuç: <em>2 examples, 0 failures</em></p>

<p>Şimdi Todo ile yaptığımız değişikliklerin programın başka kısımlarında kalan bölümleri bozup bozmadığını görmek için konsola sadece rspec yazın. Bu komut spec dizininde sonu ‘*_spec.rb’ ile biten tüm dosyaları otomatik çalıştıracaktır.</p>

<p>Eğer bütün testlerimiz geçiyorsa artık git repomuza kaydedebiliriz.</p>

<p>Unutmadan:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">git add --all
git commit -m <span class="s2">&quot;Todo model testleri geçti&quot;</span>
git checkout master
git merge todo-model
git branch -d todo-model</code></pre></div>

<h3 id="bonus-refactor">Bonus: Refactor</h3>
<p>TDD çalışırken izleyeceğimiz yolun Red-Green-Refactor olduğunu daha önce belirtmiştim. Aslında refactor yani kodun yeniden düzenlenip toparlanması her zaman yapılması gereken birşey olsa da testler yeşil olduktan sonra başka bir kod bölümüne geçmeden önce mutlaka elden geçirmek gerekiyor. User sınıfında refactor ihtiyacı olup olmadığı kanaatini size bırakıyorum. Todo test dosyasını açıp inceleyelim.</p>

<p>Kendini tekrar eden iki satır görünüyor bunlar:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">todo</span> <span class="o">=</span> <span class="no">Todo</span><span class="o">.</span><span class="n">new</span>
<span class="no">User</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">email</span><span class="p">:</span> <span class="s1">&#39;foo@example.com&#39;</span><span class="p">)</span></code></pre></div>

<p>Kod tekrarları DIY - Don’t repeat yourself! yani kendini <em>tekrarlama</em> prensibine aykırı. Bu sebeple hemen bu kısımları refactor edelim.</p>

<p>todo_spec dosyasını aşağıdaki gibi tekrar düzenleyin</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">require</span> <span class="s1">&#39;rails_helper&#39;</span>

<span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">Todo</span><span class="p">,</span> <span class="ss">:type</span> <span class="o">=&gt;</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">context</span> <span class="s1">&#39;is invalid without&#39;</span> <span class="k">do</span>
    <span class="n">subject</span> <span class="p">{</span> <span class="no">Todo</span><span class="o">.</span><span class="n">new</span> <span class="p">}</span>
    <span class="n">it</span> <span class="s1">&#39;a user&#39;</span> <span class="k">do</span>
      <span class="n">subject</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Kodlar refactor edilecek.&#39;</span>
      <span class="n">expect</span><span class="p">(</span><span class="n">subject</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">be_invalid</span>
      <span class="n">subject</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="n">fake_user</span>
      <span class="n">expect</span><span class="p">(</span><span class="n">subject</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">be_valid</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s1">&#39;a title&#39;</span> <span class="k">do</span>
      <span class="n">subject</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="kp">nil</span>
      <span class="n">subject</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="n">fake_user</span>
      <span class="n">expect</span><span class="p">(</span><span class="n">subject</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">be_invalid</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">fake_user</span>
      <span class="no">User</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">email</span><span class="p">:</span> <span class="s1">&#39;foo@example.com&#39;</span><span class="p">)</span>
    <span class="k">end</span>

  <span class="k">end</span>
<span class="k">end</span></code></pre></div>

<p>Burada kullandığımız subject adından da anlaşılacağı gibi test öznesi ve her context için ayrı ayrı özneler belirtilebilir. User.new ise gördüğünüz gibi bir fonksiyonun dönüş nesnesi oldu ve bu sayede kodumuz daha okunaklı hale gelebildi. Eğer siz de kendinizden birşey katıp kodu daha da sadeleştirmek isterseniz kendinizi bu konuda özgür hissedin çünkü yazdığımız testlerde ne beklediğimizi iyi belirledik ve koşullar yerine geldiği sürece kod içerisinde istersek at koştururuz :=) Bu da TDD programlamanın en avantajlı yanlarından birisi.</p>

          </article>

          <div class="social-share">
            <span>
              <a href="https://twitter.com/share" class="twitter-share-button" data-url="" data-via="turhanco" data-lang="tr">Tweet</a>
            </span>
            <span>
              <div class="fb-like" data-href="" data-layout="button_count" data-action="like" data-show-faces="true" data-share="true">
              </div>
            </span>
          </div>

          <div id="disqus_thread"></div>
          <script type="text/javascript">
            var disqus_shortname = 'turhancoskunblog';
            (function() {
              var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
              dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
              (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
          </script>

          <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
          <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
          <div id="fb-root"></div>

          <script>(function(d, s, id) {
            var js, fjs = d.getElementsByTagName(s)[0];
            if (d.getElementById(id)) return;
            js = d.createElement(s); js.id = id;
            js.src = "//connect.facebook.net/tr_TR/sdk.js#xfbml=1&appId=1469686916649684&version=v2.0";
            fjs.parentNode.insertBefore(js, fjs);
          }(document, 'script', 'facebook-jssdk'));</script>

          <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
          <p>
            <a href="/">Ana Sayfaya Dön</a>
          </p>

        </div>
      </div>
    </div>

  </div>
  <link rel="stylesheet" href="/css/framework/pure-min.css">
  <link rel="stylesheet" href="/css/framework/grids-responsive-min.css">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="/css/site.css">

  <script type="text/javascript" src="/js/post.js"></script>

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-41396472-1', 'auto');
    ga('require', 'displayfeatures');
    ga('send', 'pageview');

  </script>

</body>

</html>
